#!/usr/bin/ruby -w

# Disable Messages
$VERBOSE=false

# Include fileutils
require 'fileutils'
require 'open3'

site = ARGV.first

# Print Banner
puts "## Site Enabler for Bakery Server ##"
puts "Enable nginx site: #{site}"

# Nginx Config File Path
availnginxfile = "/etc/nginx/sites-available/#{site}"

enablednginxfile = "/etc/nginx/sites-enabled/#{site}"

# Write File
if File.exists?( enablednginxfile )
	puts "Site already enabled"
else
	File.symlink( availnginxfile, enablednginxfile ) 

	result = system('/etc/init.d/nginx configtest')
	
	if result
		system("/etc/init.d/nginx force-reload")
	else
		File.delete( enablednginxfile )

		puts("Failed")
	end

end

# Finished
